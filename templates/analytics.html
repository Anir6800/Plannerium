{% extends "base.html" %}

{% block title %}Analytics{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .charts-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }
    
    .chart-card {
        background: #111;
        border: 1px solid #333;
        padding: 20px;
    }

    .chart-title {
        font-size: 0.9rem;
        color: #888;
        margin-bottom: 15px;
        text-transform: uppercase;
    }

    canvas {
        width: 100% !important;
        height: 300px !important;
    }
</style>
{% endblock %}

{% block content %}
    <h1>Analytics</h1>
    <p>Performance metrics and risk assessment.</p>
    <br>

    <div class="charts-container">
        <div class="chart-card">
            <div class="chart-title">Velocity (Est. vs Actual)</div>
            <canvas id="velocityChart"></canvas>
        </div>
        <div class="chart-card">
            <div class="chart-title">Risk Matrix</div>
            <canvas id="riskChart"></canvas>
        </div>
    </div>

    <!-- 2C. Simulation Engine -->
    <div class="simulation-section" style="margin-top: 40px; border-top: 1px solid #333; padding-top: 20px;">
        <h2><i class="fas fa-flask"></i> SIMULATION ENGINE (MONTE CARLO)</h2>
        <p>Run probabilistic simulations to forecast project completion.</p>
        <br>
        <button id="run-simulation-btn" class="glass-button primary" style="padding: 10px 20px; background: #fff; color: #000; border: none; font-family: 'Fira Code'; cursor: pointer;">[ RUN SIMULATION ]</button>
        <div id="simulation-results" style="margin-top: 20px;"></div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Chart.js Global Defaults for Monochrome Theme
    Chart.defaults.color = '#666';
    Chart.defaults.borderColor = '#333';
    Chart.defaults.font.family = "'Fira Code', monospace";

    // Velocity Chart
    const ctxVelocity = document.getElementById('velocityChart').getContext('2d');
    new Chart(ctxVelocity, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [
                {
                    label: 'Estimated Hours',
                    data: [20, 25, 20, 15],
                    borderColor: '#fff',
                    borderWidth: 2,
                    tension: 0.4,
                    pointBackgroundColor: '#000',
                    pointBorderColor: '#fff'
                },
                {
                    label: 'Actual Hours',
                    data: [18, 22, 24, 10],
                    borderColor: '#666',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    tension: 0.4,
                    pointBackgroundColor: '#000'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: { color: '#fff' }
                }
            },
            scales: {
                y: {
                    grid: { color: '#222' }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });

    // Risk Matrix (Scatter Plot)
    const ctxRisk = document.getElementById('riskChart').getContext('2d');
    new Chart(ctxRisk, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Identified Risks',
                data: [
                    { x: 2, y: 8 }, // High Impact, Low Prob
                    { x: 8, y: 9 }, // High Impact, High Prob
                    { x: 5, y: 5 }, // Med Impact, Med Prob
                    { x: 9, y: 2 }, // Low Impact, High Prob
                    { x: 3, y: 3 }  // Low Impact, Low Prob
                ],
                backgroundColor: '#fff',
                pointRadius: 6,
                pointHoverRadius: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: (ctx) => `Prob: ${ctx.raw.x}, Impact: ${ctx.raw.y}`
                    }
                }
            },
            scales: {
                x: {
                    title: { display: true, text: 'Probability (1-10)', color: '#666' },
                    min: 0, max: 10,
                    grid: { color: '#222' }
                },
                y: {
                    title: { display: true, text: 'Impact (1-10)', color: '#666' },
                    min: 0, max: 10,
                    grid: { color: '#222' }
                }
            }
        }
    });
</script>
{% endblock %}
